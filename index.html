
import { RefreshCw, ArrowRightLeft, TrendingDown, TrendingUp, Info, History, JapaneseYen, CreditCard } from 'lucide-react';

const App = () => {
  const [jpyRate, setJpyRate] = useState(916.50); // 기본값 (100엔당 원화)
  const [lastUpdated, setLastUpdated] = useState(new Date().toLocaleString());
  const [jpyInput, setJpyInput] = useState('1000');
  const [krwInput, setKrwInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [trend, setTrend] = useState('down'); // up, down, stable

  // 목업 히스토리 데이터
  const historyData = [920, 918, 915, 917, 916, 914, 916.5];

  // 환율 정보 가져오기 (실제 API 연결 예시 구조)
  const fetchRate = async () => {
    setIsLoading(true);
    try {
      // 실제 구현 시 'https://open.er-api.com/v6/latest/JPY' 같은 무료 API를 활용할 수 있습니다.
      // 여기서는 데모를 위해 약간의 변동성을 준 데이터를 사용합니다.
      setTimeout(() => {
        const randomVariation = (Math.random() - 0.5) * 2;
        const newRate = 916.50 + randomVariation;
        setJpyRate(newRate);
        setLastUpdated(new Date().toLocaleString());
        setTrend(randomVariation > 0 ? 'up' : 'down');
        setIsLoading(false);
      }, 800);
    } catch (error) {
      console.error("환율 정보를 가져오는 데 실패했습니다.", error);
      setIsLoading(false);
    }
  };

  useEffect(() => {
    fetchRate();
    // 초기 계산값 설정
    updateKrwFromJpy('1000', 916.50);
  }, []);

  const updateKrwFromJpy = (val, rate = jpyRate) => {
    setJpyInput(val);
    const num = parseFloat(val.replace(/,/g, ''));
    if (!isNaN(num)) {
      setKrwInput(((num / 100) * rate).toLocaleString(undefined, { maximumFractionDigits: 0 }));
    } else {
      setKrwInput('');
    }
  };

  const updateJpyFromKrw = (val) => {
    setKrwInput(val);
    const num = parseFloat(val.replace(/,/g, ''));
    if (!isNaN(num)) {
      setJpyInput(((num / jpyRate) * 100).toLocaleString(undefined, { maximumFractionDigits: 0 }));
    } else {
      setJpyInput('');
    }
  };

  const handleJpyChange = (e) => {
    const val = e.target.value.replace(/[^0-9.]/g, '');
    updateKrwFromJpy(val);
  };

  const handleKrwChange = (e) => {
    const val = e.target.value.replace(/[^0-9.]/g, '');
    updateJpyFromKrw(val);
  };

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 font-sans p-4 md:p-8 flex justify-center items-start">
      <div className="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100">
        
        {/* Header */}
        <div className="bg-indigo-600 p-6 text-white relative">
          <div className="flex justify-between items-center mb-4">
            <h1 className="text-xl font-bold flex items-center gap-2">
              <JapaneseYen size={24} />
              엔화 환율 체크
            </h1>
            <button 
              onClick={fetchRate}
              className={`p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all ${isLoading ? 'animate-spin' : ''}`}
            >
              <RefreshCw size={20} />
            </button>
          </div>
          
          <div className="mb-2">
            <span className="text-indigo-100 text-sm">현재 100엔당</span>
            <div className="text-4xl font-black flex items-end gap-2 mt-1">
              {jpyRate.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
              <span className="text-lg font-normal mb-1">원</span>
            </div>
          </div>
          
          <div className="flex items-center gap-2 text-xs text-indigo-200 mt-2">
            <Info size={14} />
            <span>최종 업데이트: {lastUpdated}</span>
          </div>
        </div>

        {/* Content */}
        <div className="p-6 space-y-6">
          
          {/* Trend Chart (Simple SVG) */}
          <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100">
            <div className="flex justify-between items-center mb-3">
              <span className="text-sm font-semibold text-slate-500 flex items-center gap-1">
                <History size={16} /> 최근 흐름
              </span>
              <span className={`text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1 ${trend === 'up' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>
                {trend === 'up' ? <TrendingUp size={12} /> : <TrendingDown size={12} />}
                {trend === 'up' ? '상승세' : '하락세'}
              </span>
            </div>
            <div className="h-16 flex items-end justify-between gap-1 px-1">
              {historyData.map((val, i) => (
                <div 
                  key={i} 
                  className={`w-full rounded-t-sm transition-all duration-500 ${i === historyData.length - 1 ? 'bg-indigo-500' : 'bg-slate-300'}`}
                  style={{ height: `${((val - 900) / 30) * 100}%`, minHeight: '10%' }}
                />
              ))}
            </div>
          </div>

          {/* Calculator Section */}
          <div className="space-y-4">
            <div className="relative">
              <label className="text-xs font-bold text-slate-400 mb-1 block ml-1">일본 엔 (JPY)</label>
              <div className="flex items-center bg-slate-100 rounded-2xl p-4 focus-within:ring-2 ring-indigo-500 transition-all">
                <span className="text-xl font-bold text-slate-400 mr-2">¥</span>
                <input 
                  type="text" 
                  value={jpyInput}
                  onChange={handleJpyChange}
                  className="bg-transparent text-2xl font-bold w-full focus:outline-none"
                  placeholder="0"
                />
              </div>
            </div>

            <div className="flex justify-center -my-2 relative z-10">
              <div className="bg-white p-2 rounded-full shadow-md border border-slate-100">
                <ArrowRightLeft className="text-indigo-600 rotate-90" size={20} />
              </div>
            </div>

            <div className="relative">
              <label className="text-xs font-bold text-slate-400 mb-1 block ml-1">대한민국 원 (KRW)</label>
              <div className="flex items-center bg-slate-100 rounded-2xl p-4 focus-within:ring-2 ring-indigo-500 transition-all">
                <span className="text-xl font-bold text-slate-400 mr-2">₩</span>
                <input 
                  type="text" 
                  value={krwInput}
                  onChange={handleKrwChange}
                  className="bg-transparent text-2xl font-bold w-full focus:outline-none"
                  placeholder="0"
                />
              </div>
            </div>
          </div>

          {/* Quick Access */}
          <div className="grid grid-cols-3 gap-2">
            {[1000, 5000, 10000].map(amt => (
              <button 
                key={amt}
                onClick={() => updateKrwFromJpy(amt.toString())}
                className="py-2 px-3 rounded-xl border border-slate-200 text-sm font-medium hover:bg-indigo-50 hover:border-indigo-200 transition-colors"
              >
                ¥{amt.toLocaleString()}
              </button>
            ))}
          </div>
        </div>

        {/* Footer info */}
        <div className="bg-slate-50 p-6 border-t border-slate-100">
          <div className="flex items-start gap-3 bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
            <div className="bg-amber-100 p-2 rounded-lg">
              <CreditCard className="text-amber-600" size={20} />
            </div>
            <div>
              <p className="text-xs font-bold text-slate-700">환전 팁</p>
              <p className="text-[10px] text-slate-500 leading-tight">트래블로그나 트래블월렛 카드를 사용하면 환전 수수료 100% 우대를 받을 수 있습니다.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;